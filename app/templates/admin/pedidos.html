{% extends "base.html" %}
{% block titulo %}Gestión de Pedidos - TiendaOnline{% endblock %}

{% block contenido %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="titulo-seccion mb-0"><i class="bi bi-receipt"></i> Gestión de <span
                    class="texto-gradiente">Pedidos</span></h2>
            <p class="subtitulo-seccion mb-0">Administra los pedidos de los clientes</p>
        </div>
    </div>

    <div class="table-responsive">
        <table class="tabla-admin">
            <thead>
                <tr>
                    <th>N° Orden</th>
                    <th>Cliente</th>
                    <th>Email</th>
                    <th>Total</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}
                <tr>
                    <td><strong style="color: var(--color-primario);">{{ pedido.numero_orden }}</strong></td>
                    <td style="color: #fff;">{{ pedido.usuario_nombre }}</td>
                    <td style="color: var(--color-texto-claro); font-size: 0.85rem;">{{ pedido.usuario_email }}</td>
                    <td style="color: var(--color-secundario); font-weight: 600;">${{ "%.2f"|format(pedido.total) }}
                    </td>
                    <td><span class="badge-estado badge-{{ pedido.estado }}">{{ pedido.estado|capitalize }}</span></td>
                    <td style="color: var(--color-texto-claro); font-size: 0.85rem;">{{ pedido.fecha.strftime('%d/%m/%Y
                        %H:%M') if pedido.fecha else 'N/A' }}</td>
                    <td>
                        <form action="{{ url_for('admin.actualizar_pedido', pedido_id=pedido.id) }}" method="POST"
                            class="d-flex gap-1 align-items-center">
                            <select name="estado" class="form-select form-select-sm"
                                style="background: rgba(255,255,255,0.06); border: 1px solid rgba(108,92,231,0.2); color: #fff; border-radius: 8px; font-size: 0.8rem; width: auto;">
                                <option value="pendiente" {{ 'selected' if pedido.estado=='pendiente' }}>Pendiente
                                </option>
                                <option value="pagado" {{ 'selected' if pedido.estado=='pagado' }}>Pagado</option>
                                <option value="enviado" {{ 'selected' if pedido.estado=='enviado' }}>Enviado</option>
                                <option value="entregado" {{ 'selected' if pedido.estado=='entregado' }}>Entregado
                                </option>
                                <option value="cancelado" {{ 'selected' if pedido.estado=='cancelado' }}>Cancelado
                                </option>
                            </select>
                            <button type="submit" class="btn btn-sm" style="color: var(--color-exito);"
                                title="Actualizar">
                                <i class="bi bi-check-lg"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if not pedidos %}
    <div class="text-center py-5">
        <i class="bi bi-inbox" style="font-size: 3rem; color: var(--color-texto-claro);"></i>
        <p style="color: var(--color-texto-claro); margin-top: 1rem;">No hay pedidos registrados</p>
    </div>
    {% endif %}

    <div class="mt-3">
        <a href="{{ url_for('admin.panel') }}" style="color: var(--color-texto-claro);"><i class="bi bi-arrow-left"></i>
            Volver al Panel</a>
    </div>
</div>
{% endblock %}